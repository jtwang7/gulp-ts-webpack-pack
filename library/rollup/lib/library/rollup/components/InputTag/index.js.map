{"version":3,"file":"index.js","sources":["../../../../../components/InputTag/index.tsx"],"sourcesContent":["import React, { useEffect, useImperativeHandle, useRef, useState } from \"react\";\nimport cls from \"classnames\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport Input from \"../Input\";\nimport Tag from \"../Tag\";\nimport { useControllableValue } from \"../hooks/useControllableValue\";\n\nexport interface InputTagProps<T> {\n  allowClear?: boolean;\n  autoFocus?: boolean;\n  disabled?: boolean;\n  saveOnBlur?: boolean;\n  placeholder?: string;\n  className?: string | string[];\n  style?: React.CSSProperties;\n  defaultValue?: T;\n  value?: T;\n  onBlur?: (e: any) => void;\n  onFocus?: (e: any) => void;\n  onChange?: (inputValue: T, event?: any) => void;\n  onPressEnter?: (e: any) => void;\n  onRemove?: (value: T, index: number, event?: any) => void;\n  onClear?: () => void;\n}\n\nconst InputTag = (props: InputTagProps<string>, ref: any) => {\n  const inputRef = useRef<HTMLInputElement>(null!);\n  useImperativeHandle(\n    ref,\n    () => {\n      return {\n        focus() {\n          inputRef.current.focus();\n        },\n        blur() {\n          inputRef.current.blur();\n        },\n      };\n    },\n    []\n  );\n\n  const [value, setValue] = useControllableValue<string>(props);\n\n  const [tagLists, setTagLists] = useState<string[]>([]);\n  const isTagListsEmpty = tagLists.length === 0;\n\n  const increaseTag = (val: string) => {\n    setTagLists((t) => {\n      const _t = structuredClone(t);\n      _t.push(val);\n      return _t;\n    });\n  };\n  const decreaseTag = (tagPosition: number) => {\n    setTagLists((t) => {\n      const _t = [...t];\n      _t.splice(tagPosition, 1);\n      return _t;\n    });\n  };\n\n  const handleTagClear = (tag: string, tagIndex: number, e: any) => {\n    decreaseTag(tagIndex);\n    props.onRemove?.(tag, tagIndex, e);\n  };\n  const handleChange = (v: string, e: any) => {\n    setValue(v);\n  };\n  const handlePressEnter = () => {\n    // 检测是否已存在 tag\n    const isTagExisted = tagLists.find((tag) => tag === value);\n    if (value && !isTagExisted) {\n      increaseTag(value);\n      setValue(\"\");\n    }\n  };\n  // 点击清除按钮时，onClear 和 onBlur 会发生冲突，原因是因为:\n  // <input /> 会先失去焦点，触发 onBlur，然后才会触发 onClick。但因为 onBlur 触发后，关闭按钮的位置发生了变化，导致 onClick 执行失败。\n  // 我们可以将 onClick 替换为 onMouseDown，并添加 e.preventDefault() 组织 mouseDown 本身的 focus 行为来避免上述情况。\n  // 原因: 1. onMouseDown 优先于 onBlur 执行。2. 阻止 mouseDown 原生的 focus 行为可以避免触发 onBlur。\n  const handleClear = () => {\n    if (!isTagListsEmpty) {\n      setTagLists([]);\n      props.onClear?.();\n    }\n  };\n  const handleBlur = (e: any) => {\n    if (props.saveOnBlur) {\n      handlePressEnter();\n    }\n    props.onBlur?.(e);\n  };\n  const handleFocus = (e?: any) => {\n    props.onFocus?.(e);\n  };\n\n  useEffect(() => {\n    if (props.autoFocus && isTagListsEmpty) {\n      inputRef.current.focus();\n    }\n  }, [props.autoFocus, isTagListsEmpty]);\n\n  return (\n    <div className={cls(\"input-tag-container\", props.className)}>\n      {tagLists.map((tag, idx) => (\n        <Tag\n          bordered\n          closable={!props.disabled}\n          onClose={(e) => handleTagClear(tag, idx, e)}\n          key={uuidv4()}\n          className=\"input-tag-tagger\"\n        >\n          {tag}\n        </Tag>\n      ))}\n      <Input\n        ref={inputRef}\n        className=\"input-tag-inputer\"\n        placeholder=\"请输入数据\"\n        disabled={props.disabled}\n        value={value}\n        onChange={handleChange}\n        onPressEnter={handlePressEnter}\n        onBlur={handleBlur}\n        onFocus={handleFocus}\n        allowClear={props.allowClear && !isTagListsEmpty}\n        onClear={handleClear}\n      />\n    </div>\n  );\n};\n\nexport default React.forwardRef(InputTag);\n"],"names":["useRef","useImperativeHandle","useControllableValue","useState","useEffect","React","cls","Tag","uuidv4","Input"],"mappings":"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"}