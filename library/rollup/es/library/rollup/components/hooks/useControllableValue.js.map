{"version":3,"file":"useControllableValue.js","sources":["../../../../../components/hooks/useControllableValue.ts"],"sourcesContent":["import { SetStateAction, useCallback, useMemo, useRef, useState } from \"react\";\n\nexport interface Props<T> {\n  defaultValue?: T;\n  value?: T;\n  onChange?: (v: T, ...args: any[]) => void;\n}\n\nexport const useControllableValue = <T>(props: Props<T>) => {\n  const isControlled = props.hasOwnProperty(\"value\");\n  const initialState = useMemo(() => {\n    if (Reflect.has(props, \"value\")) {\n      return props.value;\n    }\n    if (Reflect.has(props, \"defaultValue\")) {\n      return props.defaultValue;\n    }\n    return undefined;\n  }, []);\n\n  // 内部状态：受控状态下，实时保持与外部状态同步\n  const innerValue = useRef<T | undefined>(initialState);\n  if (isControlled) {\n    innerValue.current = props.value;\n  }\n\n  const [, update] = useState({});\n  const forceUpdate = useCallback(() => {\n    update({});\n  }, []);\n\n  // 封装可同时控制内外状态更新的 set function\n  const setState = (v: SetStateAction<T | undefined>, ...args: any[]) => {\n    const _r =\n      typeof v === \"function\" ? (v as Function)(innerValue.current) : v;\n    if (!isControlled) {\n      innerValue.current = _r as T;\n      forceUpdate();\n    }\n    props.onChange?.(_r, ...args);\n  };\n\n  return [innerValue.current!, setState] as const;\n};\n"],"names":[],"mappings":";;AAQa,MAAA,oBAAoB,GAAG,CAAI,KAAe,KAAI;IACzD,MAAM,YAAY,GAAG,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;AACnD,IAAA,MAAM,YAAY,GAAG,OAAO,CAAC,MAAK;QAChC,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE;YAC/B,OAAO,KAAK,CAAC,KAAK,CAAC;AACpB,SAAA;QACD,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,cAAc,CAAC,EAAE;YACtC,OAAO,KAAK,CAAC,YAAY,CAAC;AAC3B,SAAA;AACD,QAAA,OAAO,SAAS,CAAC;KAClB,EAAE,EAAE,CAAC,CAAC;;AAGP,IAAA,MAAM,UAAU,GAAG,MAAM,CAAgB,YAAY,CAAC,CAAC;AACvD,IAAA,IAAI,YAAY,EAAE;AAChB,QAAA,UAAU,CAAC,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC;AAClC,KAAA;IAED,MAAM,GAAG,MAAM,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;AAChC,IAAA,MAAM,WAAW,GAAG,WAAW,CAAC,MAAK;QACnC,MAAM,CAAC,EAAE,CAAC,CAAC;KACZ,EAAE,EAAE,CAAC,CAAC;;IAGP,MAAM,QAAQ,GAAG,CAAC,CAAgC,EAAE,GAAG,IAAW,KAAI;;AACpE,QAAA,MAAM,EAAE,GACN,OAAO,CAAC,KAAK,UAAU,GAAI,CAAc,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACpE,IAAI,CAAC,YAAY,EAAE;AACjB,YAAA,UAAU,CAAC,OAAO,GAAG,EAAO,CAAC;AAC7B,YAAA,WAAW,EAAE,CAAC;AACf,SAAA;QACD,CAAA,EAAA,GAAA,KAAK,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,KAAA,EAAG,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;AAChC,KAAC,CAAC;AAEF,IAAA,OAAO,CAAC,UAAU,CAAC,OAAQ,EAAE,QAAQ,CAAU,CAAC;AAClD;;;;"}